language: ruby
rvm:
 - 2.4.6

# single test suite, non-parallel build.

env:
  global:
    - CC_TEST_REPORTER_ID=735792c4672a3d5605faa1bf4e215aa26cf317bc2c171a9f137ef4abe763c0ac
language: ruby

before_script:
  - curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 > ./cc-test-reporter
  - chmod +x ./cc-test-reporter
  - ./cc-test-reporter before-build
after_script:
  - ./cc-test-reporter after-build --exit-code $TRAVIS_TEST_RESULT

script:
  - bundle exec rails db:migrate RAILS_ENV=test
  - bundle exec rake
  - ./cc-test-reporter after-build --exit-code $TRAVIS_TEST_RESULT
  
 deploy:
  provider: heroku
  api_key:
    secure: 7f1df0e0a87fbe9168d2f1b0aa13aceea2dd8ee225539e2a7185eb965d0e469e2694d88d8b6ececaa5df6367b4ea79c8602354f58e95e0d092450db609860539
  app: projet-back-end
  run:
    - "bundle install --without development test"
    - "bundle exec rails db:migrate"    
